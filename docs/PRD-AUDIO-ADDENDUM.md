# PRD Addendum: Audio Podcast Fallback (ElevenLabs)

## 1. Context & Objective

**Goal:** Implement a fast "Audio Podcast" generation feature using ElevenLabs.
**Role:** Serves as a **fallback** and **instant gratification** layer while the user waits for the HeyGen video (which takes minutes).
**Latency:** < 5 seconds.
**Model:** `eleven_multilingual_v2` (Crucial for high-quality Russian language support).

## 2. Technical Requirements

### 2.1 Environment Variables

Add to `.env.local`:

- `ELEVENLABS_API_KEY`: API Key from ElevenLabs.

### 2.2 External APIs

- **ElevenLabs API:**
  - Endpoint: `https://api.elevenlabs.io/v1/text-to-speech/{voice_id}`
  - Voice ID: Use a pre-selected ID suitable for Russian (e.g., "Marcus" or a custom cloned voice).
  - Output Format: `mp3_44100_128`.

## 3. Backend Implementation Plan

### 3.1 New Library: `src/lib/elevenlabs.ts`

Create a client to handle the binary stream from ElevenLabs.

```typescript
// Proposed structure
export const elevenLabsClient = {
  async generateAudio(text: string): Promise<ArrayBuffer> {
    // 1. Voice ID for a deep professional male voice (Marcus)
    // Note: Verify this ID in your ElevenLabs library or use a custom one
    const VOICE_ID = "txnqEtj60BWUAAwG9wbc"; 
    
    // 2. Call API
    const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`, {
      method: 'POST',
      headers: {
        'xi-api-key': process.env.ELEVENLABS_API_KEY!,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        text,
        model_id: "eleven_multilingual_v2", // REQUIRED for Russian
        voice_settings: {
          stability: 0.5,
          similarity_boost: 0.75,
        },
      }),
    });

    if (!response.ok) throw new Error('ElevenLabs API Error');
    
    return response.arrayBuffer();
  }
};
```

### 3.2 API Route: `src/app/api/audio/create/route.ts`

Unlike HeyGen, audio generation is synchronous and fast. We don't need polling. We can return the audio data directly.

- **Method:** POST
- **Input:** `{ text }` (The script generated by LLM)
- **Process:**
  1. Call `elevenLabsClient.generateAudio(text)`.
  2. Convert `ArrayBuffer` to `Base64` string (easier to handle in client for MVP than streams).
- **Output:** JSON `{ audioBase64: "data:audio/mp3;base64,..." }`

## 4. Frontend Integration

### 4.1 Update Hook: `src/hooks/useMediaGenerator.ts`

Let's combine or extend the logic. It's better to have a unified hook that manages Script -> Audio -> Video.

**Workflow Logic:**

1. User clicks "Generate Media".
2. **Step 1:** Generate Script (LLM). -> *Display Text.*
3. **Step 2 (Auto):** Generate Audio (ElevenLabs). -> *Show Audio Player immediately.*
4. **Step 3 (Optional/User Triggered):** Generate Video (HeyGen). -> *Show Loading state.*

**Updated Hook Structure:**

```typescript
const useMediaGenerator = () => {
  const [script, setScript] = useState<string | null>(null);
  const [audioUrl, setAudioUrl] = useState<string | null>(null); // Blob URL
  const [isAudioLoading, setIsAudioLoading] = useState(false);
  // ... video states from previous PRD
  
  const generateAudioOnly = async (text: string) => {
    setIsAudioLoading(true);
    try {
      const res = await fetch('/api/audio/create', { 
        method: 'POST', 
        body: JSON.stringify({ text }) 
      });
      const data = await res.json();
      
      // Convert Base64 to Blob URL for the <audio> tag
      const resBlob = await fetch(data.audioBase64).then(r => r.blob());
      const url = URL.createObjectURL(resBlob);
      setAudioUrl(url);
    } finally {
      setIsAudioLoading(false);
    }
  };
  
  return { script, audioUrl, isAudioLoading, generateAudioOnly, ... };
};
```

### 4.2 UI Component Update: `VideoTeaserSection` -> `MultimediaSection`

Update the UI to show the audio player above the video placeholder.

**Visual Hierarchy:**

1. **Script:** (Text block)
2. **Audio:** Standard HTML5 `<audio controls className="w-full mt-2" />`
   - Shows "Generating audio..." spinner initially (takes ~3 sec).
   - Once ready, user can listen immediately.
3. **Video:** Button "Generate Video (High Quality)" below the audio player.

## 5. Success Criteria for Audio

1. Audio generation takes less than 5 seconds.
2. Russian pronunciation is natural (using `eleven_multilingual_v2`).
3. Audio plays smoothly in the browser player.

## 6. User Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Generate 1-min Teaser]                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Generating script...                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ (~5-10 sec)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Script:                                                 â”‚
â”‚  "Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ…..."                        â”‚
â”‚                                                             â”‚
â”‚  ğŸµ Generating audio...                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ (~3-5 sec)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Script:                                                 â”‚
â”‚  "Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ…..."                        â”‚
â”‚                                                             â”‚
â”‚  ğŸµ â–¶ï¸ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 0:00 / 1:02                      â”‚
â”‚                                                             â”‚
â”‚  ğŸ¬ Rendering avatar (~1 min)...                            â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35%                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ (~60-120 sec)
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ Script:                                                 â”‚
â”‚  "Ğ¥Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚ ÑƒÑĞ¿ĞµÑˆĞ½Ñ‹Ñ…..."                        â”‚
â”‚                                                             â”‚
â”‚  ğŸµ â–¶ï¸ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 0:00 / 1:02                      â”‚
â”‚                                                             â”‚
â”‚  ğŸ¬ â–¶ï¸ [Video Player]                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
